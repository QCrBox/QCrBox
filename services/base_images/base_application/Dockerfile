ARG QCRBOX_DOCKER_TAG
FROM qcrbox/base-ancestor:${QCRBOX_DOCKER_TAG}
SHELL ["/bin/bash", "-c"]

ENV QCRBOX__REGISTRY__CLIENT__HOST="127.0.0.1"
ENV QCRBOX__REGISTRY__CLIENT__PORT="8000"

HEALTHCHECK \
    --interval=60s \
    --start-period=60s \
    --start-interval=3s \
    CMD curl --fail http://127.0.0.1:${QCRBOX__REGISTRY__CLIENT__PORT}/healthz || exit 1

ARG QCRBOX_SUPERVISORD_CONF_DIR=${QCRBOX_SUPERVISORD_CONF_DIR}
COPY supervisord.base_application.conf ${QCRBOX_SUPERVISORD_CONF_DIR}/

ARG QCRBOX_REGISTRY_HOST=${QCRBOX_REGISTRY_HOST}
ENV QCRBOX_REGISTRY_HOST=${QCRBOX_REGISTRY_HOST}
ARG QCRBOX_REGISTRY_PORT=${QCRBOX_REGISTRY_PORT}
ENV QCRBOX_REGISTRY_PORT=${QCRBOX_REGISTRY_PORT}

ARG QCRBOX_HOME=${QCRBOX_ROOT_DIR}
ENV QCRBOX_HOME=${QCRBOX_HOME}
